language: java
jdk: oraclejdk8
dist: trusty
services:
- docker
env:
  global:
  - secure: NDtTkubA/d2cMTQkm9nFEwyIR6ayCfP80IqXphoE1NO4H7ozVnnJshFhOaD/JuFYBGOaG2TZOz7QcMO0Hfcds/2tvkq7F8BzLDrIIbrUSdULQc7/5Wf69DUDh5s3PwLdsoZCdHLMwiGkLPXkuh9uPbdYtT7Y4rr2/ox42X7q9RT8MGUJ1CPMyOuY18wfF2uPNQeGG2fEnOHiuJSez0eV6Tu32Ia5o7r563I8I/1zPGHOegI5g/E+RVYpInFrfbKo7GC0JPAJsH9eeNlf2sZZ7wmZYI+WdufxQ6peGP/M7DJXKc4rWHEmmVqINVOTtnR55eXYBMd5+VOSRHEF2G28S+/x8/9lbjvL6o+h8h8A3HRewlFTSUI2VGSFJe1vASVll626xbBBmlNgarXZIBTow7XzNvt+Q68uhhtX41shqPpCRzvH3TdEyxFkeegSpxOUukWI0mP5kSAqqfxQGEI7y2CkxAlNmCIt5rXI9I2Sk5K/ANB66V/quRZeKU57TR04YMCFpHtdSdhWWQflq/2dn7gGpsvHCHTL30TgsU/ERhQKjWHSqW+TlCrqcHUyv3/dr6Iebwk6WaZX+4s8aOrK+1Yz9WyQsC2RLGyfK914U+MKcffGcXGnz+1mObDhvhTsTEWW01aGsHkQRUaynHWNkftZ2cI7vw9C0P8O4u1gMQE=
  - secure: qYaanjusAM5kWcF8z0k5MSzt4zS62yR2jF6fmz23rkpRpUe8xFdkNg2R3F1CL4iOdE5lJyIxLOtSf8aab+Qs9EjVyMt3OKZxb6RDJz6lRLGSLkqgVZ/FlBMc238zDH/rbWFzT11NCl/1S4JAXOI/TqNzfOaYHhefFx+b/k2+YiTpjPgQ5W82fSBnvjeEHkDJoBXmOcozV+7GMmyOmTeBqYeD/tEj0xlr8K/RdJx7uSDp8iu/qz6TXpLjaVXa2tRNOqrIq/9VCcital/VztSx9lXa4PAHaOpUZ2+9zGU5rcLIkUXHK/ELWnqNbwF1WAwrBQc1FzJ9u5i1Ne2yiH2qoUqipZRmEzXnL0rsISrKlvVGyGPCQlKJJ2KnXDLrNSXiMXLlF7HvTfD4ZM3gibOF5TRqnGrAGHgkpzlV5SsYI5dTFf9pFSFkoVa4epx8o7juW9NNBkkLFnNyf7hGDIo6tU8W22iZ+XcPJmD7q5Q/U5Gdbimq2Ro/TIF3Xbo87CPekUQd4oAP3zLsZJ1xcYU2GD+B9CwgF1/MigmOQtvOnwimiTv2bX72t7uqKN/1qXJYtEe+3rOPtesnk4yKCb6LelbXas8A2eb3ZxeGY/KuZJjlIIGRC13PsRpHC/zv6GS/zu4O6d82XSd4IObT2UnCeI7VTTlyXK+pndsVTM0Lrtg=
  - secure: HTXWaB4Mqj2Yx94ACdgxgv2hi5CXlx+p9Ph7X+R8Z4F36BSCLpA2IAKrlpvWwVZjpb4av3B4887tOIAysRF70+DYXA769UkchXznczKy/X2aS/67apBLPudZXcjpC+NrzzVEM/FvchPszaetV5IFCrn0RMeU9VHed80su1HoPKmNIy70eLLU41LROLZu/drn/HruFqag7gjJgbffyRilzk0KnoTBgxCdiIfXQk1a+MFnMMdyhOWn5XE+80cDkMuG8yjrej1d63acKHUcme00ZfNCdIuYAOP1+YLvCOdrv8e2Wv6YxIjzF0/459Q397HVTyIP4yF8BtoDOoqrsNJj6F14W3VLO+lCsWogwuDL0BBKDyu+IIN4OnEp7fV3w1RF/sjQqI1+JLlRL8ectmHZ97Hho2xzPdw5xHFm2OOaaBdsCHYjPdyyKYkEQYjbG04et45UvE9hToWTJybWxpDwhFiUob1MKJbloTws+GnsQkMLrDExGhBxuRw2ctpNzxHqfcJ/wHxSTxpQDsRgv9+dC37j5lGb4WXnZnzZ+oGFkEmgaLEgeQB23c/dQtd1MCpb0Z6MdOVdhAxlC2QechE5Oussza/OncjQE4Oogrv/gA1uyvDG+DK5s9dxENEkJI3rswffmhhIXLes9HgmTFJkJAvfb9p3vSB5J29V/wvReI4=
  - COMMIT=${TRAVIS_COMMIT::7}
  - secure: WcTzOmPcLSPtCINJj3//pvNgE67+XbQKLol+sjFk4kUooo+DuPGydPlHBAbduvYHCVOQxVIxJUpJUwrOy8P1rc35+zTaEviJ9XuTUEKtEXHe3wya1Yyf8NuKkraD/b1qZZBOmOLRlRQmVXGQUQXj/IZzfC9NPMgK7Bzq5s6TBz1ndNbGr0zGHZRHoEzI3oSYnt84IwsR8/nw4wzUgIZQcJzUk4Yu+nlY1cTpE090cvOaxkct1wrLL5o5Su12IDmxp9utFKtLD+lQUyLSdHZrT6IlzjBKXZMGZE2+JEoRfuzItfOj5b46Q212QEatB64mQz/AAMqtwqpyq/JcMofHY3a0fGTblL+vaFnEXOAwIVCqJgt+xVMmG8aN+o8+Ms5l6ECrXK0PwQTQb/AIcDqrVddTr7KgW9RlsBIPVwGeO0n750bY5v+eLerL7zVcQXaGcexKPIWSoE9CjO17TtC5VFCBUSd5gLK7ogKkqzMQtDq8HformudnhUM6qwFwS2Z3TIGqTcHUHc1ewM9BxIC/jKSoYGSzFaFpfICklWGXqT+ZQAUj5LgMd7CNrDZvypeAi3pbt9BZYu41Hgyu8UGJfHm2MxLrSfidWtz8sjLAaPOycQF6Sboaz7drJ1ppr8keVqV0EcWTQyVC8FBf2vDCQ/m7IN+DM+vCqaRyS7tsKXk=
addons:
  sonarcloud:
    organization: hydroblok
    token:
      secure: "$SONAR_TOKEN"
script:
- "./mvnw clean install -B"
- mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar
cache:
  directories:
  - "$HOME/.m2/repository"
  - "$HOME/.sonar/cache"
after_success:
- docker login -u $DOCKER_USER -p $DOCKER_PASS
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH;
  fi`
- export IMAGE_NAME=hydroblok/prototype
- docker build -t $IMAGE_NAME:$COMMIT .
- docker tag $IMAGE_NAME:$COMMIT $IMAGE_NAME:$TAG
- docker push $IMAGE_NAME
deploy:
  provider: heroku
  api_key: "$HEROKU_API_KEY"
  app: hydroblok-prototype
