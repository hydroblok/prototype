language: java
jdk: oraclejdk8
dist: trusty
services:
- docker
env:
  global:
  - secure: NDtTkubA/d2cMTQkm9nFEwyIR6ayCfP80IqXphoE1NO4H7ozVnnJshFhOaD/JuFYBGOaG2TZOz7QcMO0Hfcds/2tvkq7F8BzLDrIIbrUSdULQc7/5Wf69DUDh5s3PwLdsoZCdHLMwiGkLPXkuh9uPbdYtT7Y4rr2/ox42X7q9RT8MGUJ1CPMyOuY18wfF2uPNQeGG2fEnOHiuJSez0eV6Tu32Ia5o7r563I8I/1zPGHOegI5g/E+RVYpInFrfbKo7GC0JPAJsH9eeNlf2sZZ7wmZYI+WdufxQ6peGP/M7DJXKc4rWHEmmVqINVOTtnR55eXYBMd5+VOSRHEF2G28S+/x8/9lbjvL6o+h8h8A3HRewlFTSUI2VGSFJe1vASVll626xbBBmlNgarXZIBTow7XzNvt+Q68uhhtX41shqPpCRzvH3TdEyxFkeegSpxOUukWI0mP5kSAqqfxQGEI7y2CkxAlNmCIt5rXI9I2Sk5K/ANB66V/quRZeKU57TR04YMCFpHtdSdhWWQflq/2dn7gGpsvHCHTL30TgsU/ERhQKjWHSqW+TlCrqcHUyv3/dr6Iebwk6WaZX+4s8aOrK+1Yz9WyQsC2RLGyfK914U+MKcffGcXGnz+1mObDhvhTsTEWW01aGsHkQRUaynHWNkftZ2cI7vw9C0P8O4u1gMQE=
  - secure: F1OpDyw2sW+hH15bYjlqtV5SefcRlPiB4X+3n7LcRSqWbuXgyimKcqdLme5DkcW/9qP1IUmtxNao2ad3rtuRmUdbYW5FQ4fiNzbtBk4iRms/bkWI/1n4DQtdaJV33N2ocmBz7uucZLVEywQLvK2i7NroEF61M2oV5BNp1bj1yzgsEqs2tmscK/2m1wFwuTYRnOSSRulXZkqE8r7zlmICK4KjMJ3KEQtTV6YslYJrA+I6WphsZwareQNt7J78eLfc8pJnasknsqzc/4WnNepluQO1qDgAzjsSEiynVTBy5hUbO+kgckycgTd+6jC2QlnluYaVCpyxB7Y+Vu7KTuXr9E1k5ml6Gd8dFcz2LyfC3uEat8TauQhtjGOJEwudC2KLXhjfOtvIARqZT2POl4ylOPlP/1eDmxNNeOlu3poKowJR6eLwIYz07a+QUcDq559vtE7I4jwGsNzpk/NC8iaifcCIwCJv/2QsKCrO5b/dFT7qnNrOECuAb6h8+TBSir3rDGADBSC9sUrFvx9KxgxSz8eoBNUrudFsZyEUseURH8bk62z7Ti1JRh0+XrwEQInOY2D9hqEwhcOTu6FEpKoYdyzKX0aPD2IlnP7RtVcXRexwDUqo9dTbLgPiEvZnVfedS9iYgQeFbp7C6i8foaaFwO1tl9/TdF+2lEgx6S4kps4=
  - secure: qYaanjusAM5kWcF8z0k5MSzt4zS62yR2jF6fmz23rkpRpUe8xFdkNg2R3F1CL4iOdE5lJyIxLOtSf8aab+Qs9EjVyMt3OKZxb6RDJz6lRLGSLkqgVZ/FlBMc238zDH/rbWFzT11NCl/1S4JAXOI/TqNzfOaYHhefFx+b/k2+YiTpjPgQ5W82fSBnvjeEHkDJoBXmOcozV+7GMmyOmTeBqYeD/tEj0xlr8K/RdJx7uSDp8iu/qz6TXpLjaVXa2tRNOqrIq/9VCcital/VztSx9lXa4PAHaOpUZ2+9zGU5rcLIkUXHK/ELWnqNbwF1WAwrBQc1FzJ9u5i1Ne2yiH2qoUqipZRmEzXnL0rsISrKlvVGyGPCQlKJJ2KnXDLrNSXiMXLlF7HvTfD4ZM3gibOF5TRqnGrAGHgkpzlV5SsYI5dTFf9pFSFkoVa4epx8o7juW9NNBkkLFnNyf7hGDIo6tU8W22iZ+XcPJmD7q5Q/U5Gdbimq2Ro/TIF3Xbo87CPekUQd4oAP3zLsZJ1xcYU2GD+B9CwgF1/MigmOQtvOnwimiTv2bX72t7uqKN/1qXJYtEe+3rOPtesnk4yKCb6LelbXas8A2eb3ZxeGY/KuZJjlIIGRC13PsRpHC/zv6GS/zu4O6d82XSd4IObT2UnCeI7VTTlyXK+pndsVTM0Lrtg=
addons:
  sonarcloud:
    organization: hydroblok
    token:
      secure: "$SONAR_TOKEN"
script:
- "./mvnw clean install -B"
- mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar
cache:
  directories:
  - "$HOME/.m2/repository"
  - "$HOME/.sonar/cache"
after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
  - export IMAGE_NAME=jimmyluo/prototype
  - docker build -t $IMAGE_NAME:$COMMIT .
  - docker tag $IMAGE_NAME:$COMMIT $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME
